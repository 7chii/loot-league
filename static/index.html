<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="/loot-league/static/styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESPOLIOS</title>
</head>

<body>

    <div id="mymodal" class="modal">
        <div class="modalCont">
            <span class="close">&times;</span>
            <div id="colec">
            </div>
        </div>
    </div>
    

    <div id="grandiv">
        <!-- div lado esquerdo (materiais, "index", 
        numeros de essencia laranja etc listados embaixo)-->
        <div id="leftsInMcseeeNums">
            <div id="drop-choice" class="modol">
                <div class="choicecont">
                    <!--<span class="closech"></span>-->
                    <button id="butap" onclick="">Aprimorar</button>
                    <button id="butde" onclick="">Desencantar</button>
                </div>
            </div>
            <!-- index -->
            <div id="indL">
                <button class="bin" id="btncol"><img src="/loot-league/static/imageAs/collmod.png" alt=""></button>
                <button class="bin"><img src="/loot-league/static/imageAs/allin.png" alt=""></button>
                <button class="bin"><img src="/loot-league/static/imageAs/bauIndl.png" alt=""></button>
                <button class="bin"><img src="/loot-league/static/imageAs/campin.png" alt=""></button>
                <button class="bin"><img src="/loot-league/static/imageAs/skinsin.png" alt=""></button>
            </div>
            <!-- materiais etc  e numeros + botao add bau embaixo -->
            <div id="mcseeeNnums">
                <!-- materiais etc -->
                <div id="mcseee" class="scrollb">
                    <input type="text" placeholder="Buscar" id="sbme">
                    <div class="drop-orgbutt">
                        <button class="orgbutt">Alfabetico</button>
                        <div class="orgbutt-content">
                            <button class="org" onclick="">Alfabetico</button>
                            <button class="org" onclick="">Valor</button>
                            <button class="org" onclick="">Campeao</button>
                            <button class="org" onclick="">Skin</button>
                        </div>
                    </div>
                    <div id="materiais">
                        <h3>materiais</h3>
                        <hr>
                        <button id="baus1" onclick="bshow()"></button>
                    </div>
                </div>
                <!-- numeros + botao bau -->
                <div id="nums">
                    <!--botao bau+chave-->
                    <button type="button" onclick="bacha()" class="info">+B</button>
                    <!-- paragrafos com essencias(azul e laranja) -->
                    <p id="EAZ" class="info">~</p>
                    <p id="ELA" class="info">~</p>
                    <!--chaves e baus!-->
                    <p id="chaves" class="info">0</p>
                    <p id="baus" class="info">0</p>
                </div>
            </div>
        </div>
        <!-- lado direito dos espolios, onde vai mostrar animacoes de abrir bau, 
        onde o campeao aparece antes de ir pra esquerda etc etc -->
        <div id="rights">
            <div id="showR">
                <button type="button" onclick="bacao()" id="acaoSh">acao</button>
            </div>
        </div>
    </div>
    <script>
        var litem = 0;
        var cam = 0;
        var receb = 0;
        var modo = document.getElementById("drop-choice");
        //funcao json b64 to src img
        function bacao() {
            if (cam === 1) {
                baction();
                banum();
            } else if(cam===2){
                
            }
        }
        function crimg(data, num, butt, tipo) {
            var but = butt;
            var img = num;
            var stringp = data.split('-');
            img.src = "data:image/jpg;base64, " + stringp[0];
            butt.setAttribute("name", stringp[1]+"-"+stringp[2]+"-"+stringp[3]+"-"+tipo);

        };
        //inventario em array basico, i[1]=numero de baus|| i[2]=essencia azul||i[3]=essencia laranja
        const inventario = [0, 0, 0];
        //valores da sessao
        document.getElementById("EAZ").innerHTML = inventario[1];
        document.getElementById("ELA").innerHTML = inventario[2];

        //add bau + mostrar botao bau
        function bacha() {
            inventario[0] = inventario[0] + 1;
            document.getElementById("chaves").innerHTML = inventario[0];
            document.getElementById("baus").innerHTML = inventario[0];
            document.getElementById("baus1").innerHTML = inventario[0];
            document.getElementById("baus1").style.display = "flex";
        }
        //display menu acao bau
        function bshow() {
            cam = 1;
            document.getElementById("showR").style.backgroundImage = 'url("/loot-league/static/imageAs/hextec.png")';
            document.getElementById("acaoSh").innerHTML = "ABRIR";
            document.getElementById("baus1").innerHTML = inventario[0] + "<span class='rtex'>(-1)</span>";
            document.getElementById("acaoSh").setAttribute( "onClick", "baction();banum()" );
            document.getElementById("showR").style.display = "block";
        }
        function ishowC(img, bot) {
            cam = 2;
            //var h = document.getElementById(`${img.id}`);
            console.log(img.id);
            console.log(bot.id);
            document.getElementById("showR").style.backgroundImage = 'url("'+img.src+'")';
            document.getElementById("acaoSh").innerHTML = "APRIMORAR";

            document.getElementById("acaoSh").setAttribute( "onClick", `champC(${bot.id}`+`,${img.id})` );
            modo.style.display = "none";
            document.getElementById("showR").style.display = "block";
        }
        function ishowV(img, bot) {
            cam = 2;
            //var h = document.getElementById(`${img.id}`);
            console.log(img.id);
            console.log(bot.id);
            document.getElementById("showR").style.backgroundImage = 'url("'+img.src+'")';
            document.getElementById("acaoSh").innerHTML = "DESENCANTAR";

            document.getElementById("acaoSh").setAttribute( "onClick", `champV(${bot.id}`+`,${img.id})` );
            modo.style.display = "none";
            document.getElementById("showR").style.display = "block";
        }
        function champC(img, bot){
            console.log(img);
            console.log(bot);
            var struse = img.getAttribute("name");
            var strina = struse.split('-');
            var custo = strina[1];
            console.log(strina[1]);
            if(strina[3]==="S"){
                inventario[2] = inventario[2] - custo;
            }else{
                inventario[1] = inventario[1] - custo;
            }
            esnum();
            modadd(bot, img);
            img.remove();
            document.getElementById("showR").style.display = "none";
        }
        function champV(img, bot){
            var struse = img.getAttribute("name");
            var strina = struse.split('-');
            var valor = strina[2];
            if(strina[3]==="S"){
                inventario[2] = inventario[2] + +valor;
            }else{
                inventario[1] = inventario[1] + +valor;
            }
            esnum();
            //modadd(bot, img);
            img.remove();
            document.getElementById("showR").style.display = "none";
        }
        function champClick(string){
            modo.style.display = "block";
            document.getElementById("butap").disabled = false;
            var stringsp = string.split('-');
            var bot = stringsp[0];
            var img = stringsp[1];
            var bna = document.getElementById(bot).getAttribute("name").split('-');
            var acc = 1;
            if(bna[3]==="S"){
                acc = inventario[2] - bna[1];
                if(acc<0){
                    document.getElementById("butap").disabled = true;
            }
            }else{
                acc = inventario[1]  - bna[1];
                if(acc<0){
                    document.getElementById("butap").disabled = true;
            }
            }
            document.getElementById("butap").setAttribute( "onClick", `ishowC(${img}`+`,${bot});`);
            document.getElementById("butde").setAttribute( "onClick", `ishowV(${img}`+`,${bot})` );
        }

        //acao abrir bau
        function baction() {
            // aleatorio se receber mais de 2 itens
            var posI = rannum(2);
            var posBCS, butt, text, elem;
            if (posI === 0) {
                //adicionar item ao materiais
                posBCS = rannum(3);
                switch (posBCS) {
                    case 0:
                        //caso recebeu bau
                        inventario[0] = inventario[0] + 1;
                        receb = receb + 1;
                        break;
                    case 1:
                        //champ
                        var tipo = "C";
                        var item = rannum(10);
                        litem = litem + 1;
                        var id = item;
                        //cria botao do item
                        butt = document.createElement("button");
                        butt.style.border = "solid rgb(120, 90, 40)";
                        butt.style.margin = "2px";
                        butt.style.height = "50px";
                        butt.style.width = "50px";
                        butt.className = "moldicon";
                        
                        //criar imagem para mostrar campeao
                        var imagem = document.createElement("img");
                        butt.id = `butt${litem}`;
                        imagem.id = `img${litem}`;
                        imagem.className = "moldicon";
                        butt.setAttribute( "onClick", `champClick("butt${litem}`+"-"+`img${litem}");` );
                        //texto para o botao
                        text = document.createTextNode(item);
                        //adiciona texto ao botao
                        fetch('/img', {
                            method: 'POST',
                            headers: {
                                Authorization: 'lootl',
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                id
                            }),
                        })
                            .then((res) => {
                                return res.json();
                            })
                            .then((data) => crimg(data, imagem, butt, tipo));
                        //adiciona botao ao div materiais
                        
                        butt.appendChild(imagem);
                        elem = document.getElementById("materiais");
                        elem.appendChild(butt);
                        break;
                    case 2:
                        //skin
                        var tipo = "S";
                        var item = rannum(10);//+"S";
                        litem = litem + 1;
                        var id = item;
                        butt = document.createElement("button");
                        butt.style.border = "solid rgb(120, 90, 40)";
                        butt.style.margin = "2px";
                        butt.style.height = "50px";
                        butt.style.width = "50px";
                        var imagem = document.createElement("img");
                        butt.id = `butt${litem}`;
                        imagem.id = `img${litem}`;
                        imagem.className = "moldicon";
                        butt.setAttribute( "onClick", `champClick("butt${litem}`+"-"+`img${litem}");` );
                        fetch('/imgs', {
                            method: 'POST',
                            headers: {
                                Authorization: 'lootl',
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                id
                            }),
                        })
                            .then((res) => {
                                return res.json();
                            })
                            .then((data) => crimg(data, imagem, butt, tipo));
                        butt.appendChild(imagem);
                        //adiciona botao ao div materiais
                        elem = document.getElementById("materiais");
                        elem.appendChild(butt);
                        break;
                }
            } else {
                //func se roda se mais de 1 item
                baction();
                posBCS = rannum(3);
                switch (posBCS) {
                    case 0:
                        //caso recebeu bau
                        inventario[0] = inventario[0] + 1;
                        receb = receb + 1;
                        break;
                    case 1:
                        //champ
                        var tipo = "C";
                        var item = rannum(10);
                        litem = litem + 1;
                        var id = item;
                        butt = document.createElement("button");
                        butt.style.border = "solid rgb(120, 90, 40)";
                        butt.style.margin = "2px";
                        butt.style.height = "50px";
                        butt.style.width = "50px";
                        //criar imagem para mostrar campeao
                        var imagem = document.createElement("img");
                        butt.id = `butt${litem}`;
                        imagem.id = `img${litem}`;
                        imagem.className = "moldicon";
                        butt.setAttribute( "onClick", `champClick("butt${litem}`+"-"+`img${litem}");` );
                        fetch('/img', {
                            method: 'POST',
                            headers: {
                                Authorization: 'lootl',
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                id
                            }),
                        })
                            .then((res) => {
                                return res.json();
                            })
                            .then((data) => crimg(data, imagem, butt, tipo));
                        //adiciona botao ao div materiais
                        butt.appendChild(imagem);
                        elem = document.getElementById("materiais");
                        elem.appendChild(butt);
                        break;
                    case 2:
                        //skin
                        var tipo = "S";
                        var item = rannum(10);//+"S";
                        litem = litem + 1;
                        var id = item;
                        butt = document.createElement("button");
                        butt.style.border = "solid rgb(120, 90, 40)";
                        butt.style.margin = "2px";
                        butt.style.height = "50px";
                        butt.style.width = "50px";
                        
                        //criar imagem para mostrar campeao
                        var imagem = document.createElement("img");
                        butt.id = `butt${litem}`;
                        imagem.id = `img${litem}`;
                        imagem.className = "moldicon";
                        butt.setAttribute( "onClick", `champClick("butt${litem}`+"-"+`img${litem}");` );
                        fetch('/imgs', {
                            method: 'POST',
                            headers: {
                                Authorization: 'lootl',
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                id
                            }),
                        })
                            .then((res) => {
                                return res.json();
                            })
                            .then((data) => crimg(data, imagem, butt, tipo));
                        //adiciona botao ao div materiais
                        butt.appendChild(imagem);
                        elem = document.getElementById("materiais");
                        elem.appendChild(butt);
                        break;
                }
            }


        }
        function esnum(){
            document.getElementById("EAZ").innerHTML = inventario[1];
            document.getElementById("ELA").innerHTML = inventario[2];
        }
        function banum() {
            inventario[0] = inventario[0] - 1;

            //atualizar valores dos textos
            document.getElementById("chaves").innerHTML = inventario[0];
            document.getElementById("baus").innerHTML = inventario[0];
            if(receb===0){
                document.getElementById("baus1").innerHTML = inventario[0];
            }else{
                document.getElementById("baus1").innerHTML = "<span class='gtex'>(+"+receb+")</span>"+inventario[0];
                receb = 0;
            }
            //hide menu acao bau
            document.getElementById("showR").style.display = "none";
            //se zero baus -> esconder botao baus *
            if (inventario[0] === 0) {
                document.getElementById("baus1").style.display = "none";
            } else if (inventario[0] < 0) {
                //nao deixa numero negativo de baus e chaves *
                inventario[0] = 0;
            } else { }
            document.getElementsByClassName("gtex").display = "none";
        }
        //numero aleatorio entre 0  e  <numb>
        function rannum(numb) {
            return Math.floor(Math.random() * numb);
        }
        function modadd(img, bot){
            //console.log(img);
            var struse = bot.getAttribute("name");
            var strina = struse.split('-');
            //nome skin
            console.log(strina[0]);
            console.log(strina[3]);
            var imagem = document.createElement("img");
            imagem.src = img.src
            imagem.className = "colit";
            elem = document.getElementById("colec");
            elem.appendChild(imagem);
        }
        //modal colecao
        var modal = document.getElementById("mymodal");
            var btnLog = document.getElementById("btncol");

            var span = document.getElementsByClassName("close")[0];
            
            btnLog.onclick = function(){
                modal.style.display = "block";
            }
            
            //fechar modal no X
            span.onclick = function() {
                mymodal.style.display = "none";
            }

            // fechar modal se click fora da tela
            window.onclick = function(event) {
                if (event.target == modal) {
                mymodal.style.display = "none";
                }
            }

        //modal escolha desenc enc
       
            //var btnLog = document.getElementById("butt1");

            //var span = document.getElementsByClassName("close")[0];
            
            
            //fechar modal no X
            /*span.onclick = function() {
                mymodal.style.display = "none";
            }*/

            // fechar modal se click fora da tela
            window.onclick = function(event) {
                if (event.target == modo) {
                modo.style.display = "none";
                }
            }

    </script>
</body>

</html>